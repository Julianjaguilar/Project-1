<!DOCTYPE html>
<html>
<head>
    <title>TomTom API Search</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        body {
            background-color: #2C3E50;
            color: #18BC9C;
        }
        table {
            background-color: #34495E;
            border-color: #18BC9C;
        }
        th, td {
            border-color: #18BC9C;
            color: white; 
        }
        .btn {
            background-color: #18BC9C;
            color: #2C3E50;
            border-color: #18BC9C;
        }
        .btn:hover {
            background-color: #27AE60;
            color: #2C3E50;
            border-color: #27AE60;
        }
        input[type="search"], .slider {
            background-color: #34495E;
            color: #18BC9C;
            border-color: #18BC9C;
        }
        ul {
            list-style-type: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <input type="search" placeholder="Address" id="addressInput" class="form-control mt-3">
        <div class="slidecontainer mt-3">
            <input type="range" min="1" max="25" value="10" class="slider form-range" id="radius">
            <span id="radiusValue">10 mi</span>
        </div>
        <ul class="mt-3">
            <li>               
                <input id="chk_coffee" type="checkbox" value="9376006">
                <label for="chk_coffee">Coffee</label>
            </li>
            <li>
                <label><input type="checkbox" value="9362008"> Park</label>
            </li>
            <li>
                <label><input type="checkbox" value="7332005"> Super Market</label>
            </li>
            <li>
                <label><input type="checkbox" value="7315015"> Fast Food</label>
            </li>
            <li>
                <label><input type="checkbox" value="7315020"> Restaurant</label>
            </li>
            <li>
                <label><input type="checkbox" value="7315036"> Pizzaria</label>
            </li>
            <li>
                <label><input type="checkbox" value="9375"> Veterinarian</label>
            </li>
            <li>
                <label><input type="checkbox" value="9361018"> Bakery</label>
            </li>
            <li>
                <label><input type="checkbox" value="9376002"> Caf√©</label>
            </li>
            <li>
                <label><input type="checkbox" value="7315078"> Ice Cream</label>
            </li>
        
    </ul>
</ul>
<button id="searchBtn" class="btn mt-3">Search</button>
<table class="table mt-3">
    <thead>
        <tr>
            <th>Distance</th>
            <th>Name</th>
            <th>Phone</th>
            <th>Address</th>
        </tr>
    </thead>
    <tbody id="resultTable">
        <!-- Search results go here -->
    </tbody>
</table>
</div>

    <script>
        const apiKey = "Bdv7pnZ1L2aRNw7L0NjHQAwtIPjQmGsD";

        $("#radius").on("input", function() {
            $("#radiusValue").text(this.value + " mi");
        }); 
        $("#searchBtn").click(function() {

        var query = $("#addressInput").val();
        if (query == "") {
            // If no query is provided, retrieve current geolocation
            navigator.geolocation.getCurrentPosition(function(location) {
                var lat = location.coords.latitude;
                var lon = location.coords.longitude;
                getResults(lat, lon);
            });
        } else {
            // Request geolocation data from TomTom Geocoding API using the provided query
            var geoapiUrl = `https://api.tomtom.com/search/2/geocode/${query}.json?key=${apiKey}`;
            $.getJSON(geoapiUrl, function(data) {
                var lat = data.results[0].position.lat;
                var lon = data.results[0].position.lon;
                getResults(lat, lon);
            });
        }

        function getResults(lat, lon) {
            // Set the response radius to the user's input
            var radius = $("#radius").val() * 1609.3440; // convert to meters
            radius += 150;

            // Get the user's selected categories
            var categorySet = [];
            $("input[type=checkbox]:checked").each(function() {
                categorySet.push($(this).val());
            });

            // Request POI data from TomTom nearbySearch API using the provided location and categories
            var poiapiUrl = `https://api.tomtom.com/search/2/nearbySearch/.json?key=${apiKey}&limit=100&lat=${lat}&lon=${lon}&radius=${radius}&categorySet=${categorySet.join(",")}`;
            $.getJSON(poiapiUrl, function(data) {
                displayResults(data.results);
            });
        }

        // Function to display search results in an HTML table
        function displayResults(results) {
            var table = $("#resultTable");
            table.find("tr").remove(); // clear old results
            results.forEach(function(result) {
                const dist = Math.round(result.dist * 0.000621371 * 10) / 10;
                const { name, phone } = result.poi;
                const address = result.address.freeformAddress;
                var brand; if (result.poi.brands && result.poi.brands[0]) brand = result.poi.brands[0].name;
                table.append(`<tr><td>${dist} mi</td><td>${brand || name}</td><td>${phone}</td><td>${address}</td></tr>`);
            });
        }

        });
    </script>
</body>
</html>
